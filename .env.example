# ============================================================================
# Fire Department Radio Transcription System
# Environment Configuration Template
# ============================================================================
#
# Copy this file to `.env` and fill in your actual values.
# DO NOT commit `.env` to version control!
#
# Last Updated: January 2025
#

# ============================================================================
# OpenAI API Configuration
# ============================================================================
# Required for audio transcription (Whisper) and AI analysis (GPT-4)
#
# Get your API key from: https://platform.openai.com/api-keys
# Documentation: https://platform.openai.com/docs/api-reference

# OpenAI API Key (Required)
OPENAI_API_KEY=sk-proj-your-api-key-here

# OpenAI Model Configuration
OPENAI_MODEL=gpt-4o                    # Model for template generation and compliance analysis
OPENAI_WHISPER_MODEL=whisper-1         # Model for audio transcription
OPENAI_MAX_UPLOAD_MB=25                # Whisper API file size limit (MB)

# Rate Limiting
OPENAI_MAX_REQUESTS_PER_MINUTE=50      # API rate limit (tier-based)
OPENAI_MAX_TOKENS_PER_REQUEST=4000     # Maximum tokens per request

# ============================================================================
# Database Configuration (PostgreSQL)
# ============================================================================
# PostgreSQL database for persistent storage
#
# Development (Docker): Uses local Docker container
# Production: Use managed service (Azure Database, AWS RDS, etc.)

# Database Connection String (Required)
# Format: postgresql://USER:PASSWORD@HOST:PORT/DATABASE?schema=SCHEMA
DATABASE_URL="postgresql://transcriber:transcriber_password@localhost:5433/transcriber_db?schema=public"

# Individual PostgreSQL Settings (for Docker Compose)
POSTGRES_USER=transcriber
POSTGRES_PASSWORD=transcriber_password
POSTGRES_DB=transcriber_db

# Connection Pool Settings (Optional - Prisma handles this)
# DATABASE_POOL_SIZE=10
# DATABASE_CONNECTION_TIMEOUT=30000

# ============================================================================
# Redis Configuration
# ============================================================================
# Redis for caching, rate limiting, and job queues
#
# Development (Docker): Uses local Docker container
# Production: Use managed service (Azure Cache for Redis, AWS ElastiCache)

# Redis Connection String (Required)
REDIS_URL="redis://localhost:6380"

# Redis Password (Production - leave empty for development)
REDIS_PASSWORD=

# Cache TTL Configuration (seconds)
REDIS_CACHE_TTL=3600                   # Default: 1 hour
REDIS_SESSION_TTL=86400                # Default: 24 hours

# ============================================================================
# Application Settings
# ============================================================================

# Node Environment (development | production | test)
NODE_ENV=development

# Application URL (for generating file URLs)
NEXT_PUBLIC_APP_URL=http://localhost:3000
NEXT_PUBLIC_API_URL=http://localhost:3000/api

# Application Port (optional - Next.js default is 3000)
# PORT=3000

# ============================================================================
# File Storage Configuration
# ============================================================================
# Choose storage provider: local | azure | s3
# Development: Use 'local' for simplicity
# Production: Use 'azure' or 's3' for scalability

# Storage Provider (local | azure | s3)
STORAGE_TYPE=local

# Local Storage Settings (when STORAGE_TYPE=local)
UPLOAD_DIR=./uploads                   # Local upload directory
STORAGE_PATH=./uploads                 # Deprecated (use UPLOAD_DIR)
MAX_FILE_SIZE_MB=500                   # Maximum file size for uploads (MB)

# Azure Blob Storage Settings (when STORAGE_TYPE=azure)
# AZURE_STORAGE_CONNECTION_STRING=DefaultEndpointsProtocol=https;AccountName=...
# AZURE_STORAGE_CONTAINER=fire-dept-uploads
# AZURE_STORAGE_ACCOUNT_NAME=your-storage-account
# AZURE_STORAGE_ACCOUNT_KEY=your-storage-key

# AWS S3 Storage Settings (when STORAGE_TYPE=s3)
# AWS_REGION=us-east-1
# AWS_ACCESS_KEY_ID=your-access-key
# AWS_SECRET_ACCESS_KEY=your-secret-key
# AWS_S3_BUCKET=fire-dept-uploads

# ============================================================================
# Audio Processing Configuration
# ============================================================================

# Transcription Settings
TRANSCRIPTS_DIR=transcripts            # Directory for transcript storage
AUTO_DETECT_MAYDAY=true               # Automatically detect mayday calls
EMERGENCY_KEYWORD_DETECTION=true      # Enable emergency keyword detection

# Supported Audio Formats (comma-separated)
SUPPORTED_AUDIO_FORMATS=mp3,mp4,m4a,wav,webm

# Audio Processing Limits
MAX_AUDIO_DURATION_SECONDS=14400      # Max 4 hours
MIN_AUDIO_DURATION_SECONDS=1          # Min 1 second

# ============================================================================
# Policy Document Processing
# ============================================================================

# Supported Document Formats (comma-separated)
SUPPORTED_DOCUMENT_FORMATS=pdf,docx,xlsx,pptx,txt,md

# Document Processing Limits
MAX_DOCUMENT_SIZE_MB=50               # Maximum policy document size
MAX_DOCUMENT_PAGES=200                # Maximum pages for template generation

# ============================================================================
# Compliance & Template Settings
# ============================================================================

# Scoring Thresholds
COMPLIANCE_PASS_THRESHOLD=0.85        # Score >= 85% = PASS
COMPLIANCE_IMPROVEMENT_THRESHOLD=0.70 # Score 70-84% = NEEDS_IMPROVEMENT
# Score < 70% = FAIL

# Template Generation
AI_TEMPLATE_CONFIDENCE_THRESHOLD=0.80  # Minimum confidence for auto-approval
MAX_TEMPLATE_CATEGORIES=15            # Maximum categories per template
MAX_TEMPLATE_CRITERIA_PER_CATEGORY=20 # Maximum criteria per category

# ============================================================================
# Security Settings (Production)
# ============================================================================

# CORS Settings (Production - restrict origins)
# ALLOWED_ORIGINS=https://yourdomain.com,https://app.yourdomain.com

# Session Secret (Production - use strong random string)
# SESSION_SECRET=your-super-secret-session-key-here

# JWT Settings (Future - when authentication is implemented)
# JWT_SECRET=your-jwt-secret-here
# JWT_EXPIRATION=24h

# API Rate Limiting (requests per minute per IP)
# API_RATE_LIMIT=100

# ============================================================================
# Email Configuration (Future - Optional)
# ============================================================================
# For sending audit reports, notifications, etc.

# Email Provider (sendgrid | ses | smtp)
# EMAIL_PROVIDER=sendgrid

# SendGrid Configuration
# SENDGRID_API_KEY=your-sendgrid-api-key
# SENDGRID_FROM_EMAIL=noreply@yourdomain.com
# SENDGRID_FROM_NAME=Fire Dept Transcription System

# SMTP Configuration (alternative to SendGrid)
# SMTP_HOST=smtp.gmail.com
# SMTP_PORT=587
# SMTP_USER=your-email@gmail.com
# SMTP_PASS=your-app-password
# SMTP_FROM=noreply@yourdomain.com

# ============================================================================
# Monitoring & Logging (Production)
# ============================================================================

# Log Level (debug | info | warn | error)
LOG_LEVEL=info

# Application Insights (Azure) - for production monitoring
# APPLICATIONINSIGHTS_CONNECTION_STRING=InstrumentationKey=...

# Sentry Error Tracking (Optional)
# SENTRY_DSN=https://your-sentry-dsn@sentry.io/project-id
# SENTRY_ENVIRONMENT=production

# Performance Monitoring
# ENABLE_PERFORMANCE_MONITORING=true
# PERFORMANCE_SAMPLE_RATE=0.1           # Sample 10% of transactions

# ============================================================================
# Feature Flags
# ============================================================================
# Enable/disable features for gradual rollout

# Core Features
ENABLE_AUDIO_TRANSCRIPTION=true
ENABLE_POLICY_ANALYSIS=true
ENABLE_COMPLIANCE_AUDITING=true
ENABLE_TEMPLATE_GENERATION=true

# Advanced Features (Future)
# ENABLE_MULTI_LANGUAGE=false
# ENABLE_SPEAKER_DIARIZATION=false
# ENABLE_REAL_TIME_ANALYSIS=false
# ENABLE_AUDIO_PLAYBACK=false

# ============================================================================
# Development Tools (Development Only)
# ============================================================================

# Prisma Studio (Database GUI)
# Run: npx prisma studio
# Accessible at: http://localhost:5555

# Enable query logging in development
# PRISMA_QUERY_LOG=true

# Enable debug mode
# DEBUG=true
# VERBOSE_ERRORS=true

# ============================================================================
# Docker Configuration (for Docker Compose)
# ============================================================================
# These are used by docker-compose.yml and should match your Docker setup

# PostgreSQL (Docker)
DOCKER_POSTGRES_PORT=5433             # Host port for PostgreSQL
DOCKER_REDIS_PORT=6380                # Host port for Redis
DOCKER_PGADMIN_PORT=5050              # Host port for pgAdmin

# pgAdmin Configuration
PGADMIN_DEFAULT_EMAIL=admin@transcriber.local
PGADMIN_DEFAULT_PASSWORD=admin

# ============================================================================
# Testing Configuration (Test Environment)
# ============================================================================

# Test Database (use separate database for tests)
# TEST_DATABASE_URL="postgresql://transcriber:transcriber_password@localhost:5433/transcriber_test?schema=public"

# Mock API Keys for Testing (use dummy keys that won't be charged)
# OPENAI_API_KEY_TEST=sk-test-mock-key

# ============================================================================
# Backup & Data Retention
# ============================================================================

# Automatic Cleanup Settings
AUTO_CLEANUP_ENABLED=false            # Enable automatic file cleanup
CLEANUP_DAYS_AUDIO=90                 # Delete audio files after 90 days
CLEANUP_DAYS_TRANSCRIPTS=365          # Delete transcripts after 1 year
CLEANUP_DAYS_POLICY_DOCS=never        # Never delete policy documents

# Backup Configuration
# BACKUP_ENABLED=false
# BACKUP_SCHEDULE=0 2 * * *            # Daily at 2 AM (cron format)
# BACKUP_RETENTION_DAYS=30

# ============================================================================
# Webhook Configuration (Future - Optional)
# ============================================================================
# For integrating with external systems

# Webhook URLs
# WEBHOOK_TRANSCRIPTION_COMPLETE=https://your-webhook-url.com/transcription
# WEBHOOK_AUDIT_COMPLETE=https://your-webhook-url.com/audit

# Webhook Authentication
# WEBHOOK_SECRET=your-webhook-secret-key

# ============================================================================
# End of Configuration
# ============================================================================
#
# Notes:
# - In production, use environment-specific .env files (.env.production, .env.staging)
# - Never commit .env files to version control
# - Use secrets management services (Azure Key Vault, AWS Secrets Manager) for production
# - Rotate API keys and secrets regularly
# - Enable HTTPS in production
# - Configure proper CORS and security headers
#
# For more information:
# - Product Specification: /PRODUCT_SPECIFICATION.md
# - Docker Setup: /DOCKER_SETUP.md
# - Implementation Plan: /PHASE1_BACKEND_IMPLEMENTATION_PLAN.md
